# üîó –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π players

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–î–æ:**

```sql
CREATE TABLE licensed_players (
  id INT PRIMARY KEY,
  license_number VARCHAR(20),
  full_name VARCHAR(255),  -- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  city VARCHAR(100),
  license_date DATE,
  year INT,
  is_active BOOLEAN
);
```

**–ü–æ—Å–ª–µ:**

```sql
CREATE TABLE licensed_players (
  id INT PRIMARY KEY,
  player_id INT NOT NULL,              -- –°–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π players
  license_number VARCHAR(20),
  city VARCHAR(100),
  license_date DATE,
  year INT,
  is_active BOOLEAN,
  FOREIGN KEY (player_id) REFERENCES players(id) ON DELETE CASCADE,
  UNIQUE KEY unique_player_year (player_id, year)  -- –û–¥–∏–Ω –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ª–∏—Ü–µ–Ω–∑–∏—é –≤ –≥–æ–¥—É
);
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î

- ‚úÖ `init-database.sql` - –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
- ‚úÖ `mysql/init/01-init.sql` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Docker

### 3. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

- ‚úÖ `link-licensed-players.ts` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `players` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `full_name` –∏–∑ `licensed_players`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ `player_id`
- –£–¥–∞–ª—è–µ—Ç –ø–æ–ª–µ `full_name` –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### 4. –û–±–Ω–æ–≤–ª–µ–Ω—ã –º–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

- ‚úÖ `types/index.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `LicensedPlayer` –∏ `LicensedPlayerUploadData`
- ‚úÖ `LicensedPlayerModel.ts` - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚úÖ `AdminController.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `player_name` –≤–º–µ—Å—Ç–æ `full_name`
- ‚úÖ `TournamentController.ts` - —É–ø—Ä–æ—â–µ–Ω—ã SQL –∑–∞–ø—Ä–æ—Å—ã (JOIN —á–µ—Ä–µ–∑ player_id)
- ‚úÖ `PlayerTournamentPointsModel.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –ø–æ–∏—Å–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
- ‚úÖ `PlayerModel.ts` - —É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏—Ü–µ–Ω–∑–∏–π
- ‚úÖ `TeamController.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å –ø–æ–∏—Å–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π

- ‚úÖ `migrate.ts` - –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

- –ò–º—è –∏–≥—Ä–æ–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `players`
- –ò—Å–∫–ª—é—á–µ–Ω—ã –æ—à–∏–±–∫–∏ –∏–∑-–∑–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∏–º–µ–Ω

### ‚úÖ –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

- –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Å–≤—è–∑—å `player_id`
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ —Å–ª–æ–∂–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏—è—Ö –∏–º–µ–Ω

### ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

**–î–æ:**

```sql
LEFT JOIN licensed_players lp ON LOWER(TRIM(lp.full_name)) = LOWER(TRIM(p.name))
```

**–ü–æ—Å–ª–µ:**

```sql
LEFT JOIN licensed_players lp ON lp.player_id = p.id
```

### ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

- –û–¥–∏–Ω –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∞–∫—Ç–∏–≤–Ω—É—é –ª–∏—Ü–µ–Ω–∑–∏—é –≤ –≥–æ–¥—É
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏—Ü–µ–Ω–∑–∏–π

## üîÑ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ù–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞—Å—Ç—Å—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
docker-compose down && docker-compose up -d
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î

```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
docker exec petanque-mysql mysqldump -u root -p petanque_rating > backup.sql

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cd backend && npm run migrate
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –≥–æ–¥–∞:

```sql
SELECT p.name, lp.license_number, lp.city
FROM licensed_players lp
JOIN players p ON lp.player_id = p.id
WHERE lp.year = 2025 AND lp.is_active = TRUE
ORDER BY p.name;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏—Ü–µ–Ω–∑–∏–∏ –∏–≥—Ä–æ–∫–∞:

```sql
SELECT COUNT(*) as is_licensed
FROM licensed_players lp
WHERE lp.player_id = ? AND lp.year = ? AND lp.is_active = TRUE;
```

### –ü–æ–∏—Å–∫ –∫–æ–º–∞–Ω–¥ —Å –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏:

```sql
SELECT t.*, GROUP_CONCAT(p.name) as players
FROM teams t
JOIN team_players tp ON t.id = tp.team_id
JOIN players p ON tp.player_id = p.id
WHERE EXISTS (
  SELECT 1 FROM licensed_players lp
  WHERE lp.player_id = p.id AND lp.year = 2025 AND lp.is_active = TRUE
)
GROUP BY t.id;
```

## üö® –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ API

### –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞

**–î–æ:**

```json
{
  "license_number": "2025001",
  "full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "city": "–ú–æ—Å–∫–≤–∞",
  "license_date": "2025-01-01",
  "year": 2025
}
```

**–ü–æ—Å–ª–µ:**

```json
{
  "license_number": "2025001",
  "player_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", // –ò–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è
  "city": "–ú–æ—Å–∫–≤–∞",
  "license_date": "2025-01-01",
  "year": 2025
}
```

### –û—Ç–≤–µ—Ç API —Å –¥–∞–Ω–Ω—ã–º–∏ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞

**–î–æ:**

```json
{
  "id": 1,
  "license_number": "2025001",
  "full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "city": "–ú–æ—Å–∫–≤–∞"
}
```

**–ü–æ—Å–ª–µ:**

```json
{
  "id": 1,
  "player_id": 42, // –ù–æ–≤–æ–µ –ø–æ–ª–µ - ID –∏–≥—Ä–æ–∫–∞
  "license_number": "2025001",
  "city": "–ú–æ—Å–∫–≤–∞",
  "player_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" // –ò–º—è –±–µ—Ä–µ—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã players
}
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ü–æ–ª–µ `full_name` —É–¥–∞–ª–µ–Ω–æ** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `licensed_players`
2. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `player_id`** –¥–ª—è —Å–≤—è–∑–∏ —Å —Ç–∞–±–ª–∏—Ü–µ–π `players`
3. **API –∏–∑–º–µ–Ω–µ–Ω** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `player_name` –≤–º–µ—Å—Ç–æ `full_name`
4. **–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ** - –æ–¥–∏–Ω –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ª–∏—Ü–µ–Ω–∑–∏—é –≤ –≥–æ–¥—É
5. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ –ª–∏—Ü–µ–Ω–∑–∏–∏

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤:

- üìä **–ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è** - –±—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- üîó **–¶–µ–ª–æ—Å—Ç–Ω–∞—è** - –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–∞—è** - –≥–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- üîç **–ü—Ä–æ—Å—Ç–∞—è** - –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- üöÄ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
