# Ролевая модель системы рейтинга

## Обзор

Система поддерживает две роли пользователей:

- **ADMIN** - Администратор с полными правами
- **MANAGER** - Организатор турнира с ограниченными правами

## Роли и права доступа

### ADMIN (Администратор)

Полный доступ ко всем функциям системы:

✅ **Турниры**

- Загрузка турниров (Excel, Google Sheets)
- Просмотр всех турниров
- Удаление турниров
- Удаление результатов турниров
- Пересчет очков

✅ **Игроки**

- Просмотр списка игроков
- Создание игроков
- Редактирование игроков
- Удаление игроков

✅ **Лицензионные игроки**

- Просмотр лицензионных игроков
- Создание/редактирование лицензионных игроков
- Загрузка из Excel
- Удаление лицензионных игроков

✅ **Пользователи**

- Просмотр всех пользователей
- Создание пользователей (ADMIN/MANAGER)
- Редактирование пользователей
- Удаление пользователей

✅ **Настройки**

- Изменение настроек рейтинга
- Настройка количества лучших результатов

✅ **Панель управления**

- Доступ к статистике
- Удаление всех команд
- Быстрые действия

### MANAGER (Организатор турнира)

Ограниченный доступ для организации турниров:

✅ **Турниры**

- Загрузка турниров (Excel, Google Sheets)
- Просмотр всех турниров
- Просмотр деталей турниров

✅ **Игроки**

- Просмотр списка игроков
- Создание игроков
- Редактирование игроков

✅ **Лицензионные игроки**

- Просмотр лицензионных игроков
- Создание/редактирование лицензионных игроков
- Загрузка из Excel

❌ **Ограничения**

- Нет доступа к панели управления
- Нет доступа к настройкам системы
- Нет доступа к управлению пользователями
- Не может удалять турниры
- Не может удалять игроков
- Не может удалять лицензионных игроков
- Не может удалять результаты турниров

## Безопасность

### Пароли

- Минимальная длина: 6 символов
- Хешируются с использованием bcrypt (salt rounds: 10)
- Хранятся в БД в зашифрованном виде

### JWT токены

- Срок действия: 7 дней
- Содержат: userId, username, role
- Автоматически проверяются на каждом запросе

## Troubleshooting

### Не вижу раздел "Пользователи"

➡️ Проверьте свою роль. Раздел доступен только для ADMIN.

### Не вижу "Панель управления"

➡️ Панель управления доступна только для ADMIN.

### Ошибка 403 при попытке создать пользователя

➡️ Убедитесь, что вы вошли с правами ADMIN.

### Не могу удалить турнир/игрока

➡️ Функция удаления доступна только для ADMIN.

## Миграция существующих пользователей

Если у вас есть существующие пользователи в таблице `admins`:

1. Миграция автоматически перенесет их в таблицу `users`
2. Всем будет присвоена роль ADMIN
3. Поле `name` будет заполнено значением из `username`
4. Рекомендуется обновить имена пользователей через UI или API

```sql
-- Обновить имя пользователя
UPDATE users SET name = 'Иванов Иван' WHERE username = 'admin';
```

## Разработка

### Добавление новых ролей

1. Обновите enum в `backend/src/types/index.ts`:

```typescript
export enum UserRole {
  ADMIN = "ADMIN",
  MANAGER = "MANAGER",
  NEW_ROLE = "NEW_ROLE",
}
```

2. Обновите enum в базе данных:

```sql
ALTER TABLE users MODIFY role ENUM('ADMIN', 'MANAGER', 'NEW_ROLE');
```

3. Обновите middleware и проверки прав доступа

### Тестирование

```bash
# Backend тесты
cd backend
npm test

# Проверка роутов
npm run test:routes
```
