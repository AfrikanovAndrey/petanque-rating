# –í–∞—Ä–∏–∞–Ω—Ç—ã —Å–±–æ—Ä–∫–∏ Backend –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é

## üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å–±–æ—Ä–∫–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: SWC –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä (—Ç—Ä–µ–±—É–µ—Ç—Å—è < 256 MB RAM) ‚ö° –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

**–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –∏ –ª–µ–≥–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç!** SWC –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ Rust –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 20 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ TypeScript.

**Dockerfile:** `Dockerfile.swc`  
**–õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏:** < 256 MB  
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è (—Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ –º–∏–Ω—É—Ç)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –û—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å TypeScript

**–ö–æ–º–∞–Ω–¥—ã:**

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
npm run build:swc

# Docker —Å–±–æ—Ä–∫–∞
docker build -f Dockerfile.swc -t petanque-backend .

# –ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
./build-backend.sh swc
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–±–æ—Ä–∫–∞ TypeScript (—Ç—Ä–µ–±—É–µ—Ç—Å—è ~1024 MB RAM)

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π TypeScript –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —Å –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–æ–≤.

**Dockerfile:** `Dockerfile`  
**–õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏:** 1024 MB  
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –û—Ç–∫–ª—é—á–µ–Ω—ã declaration maps
- –û—Ç–∫–ª—é—á–µ–Ω—ã source maps
- –í–∫–ª—é—á–µ–Ω–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è
- –ò—Å–∫–ª—é—á–µ–Ω—ã —Ç–µ—Å—Ç—ã –∏–∑ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

**–ö–æ–º–∞–Ω–¥—ã:**

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
npm run build

# Docker —Å–±–æ—Ä–∫–∞
docker build -f Dockerfile -t petanque-backend .
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–±–æ—Ä–∫–∞ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è ~384-512 MB RAM)

–î–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å –æ—á–µ–Ω—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é, –µ—Å–ª–∏ SWC –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç.

**Dockerfile:** `Dockerfile.lowmem`  
**–õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏:** 384 MB  
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ (384 MB)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript
- –û—Ç–∫–ª—é—á–µ–Ω—ã –≤—Å–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (maps, declarations)

**–ö–æ–º–∞–Ω–¥—ã:**

```bash
# –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
npm run build:low-memory

# Docker —Å–±–æ—Ä–∫–∞
docker build -f Dockerfile.lowmem -t petanque-backend .
```

---

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ –≤—Å–µ –µ—â–µ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π –ø–∞–º—è—Ç–∏:

#### 1. –£–≤–µ–ª–∏—á—å—Ç–µ –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏ –≤ `package.json`:

```json
"build": "node --max-old-space-size=1024 ./node_modules/.bin/tsc -p tsconfig.prod.json"
```

#### 2. –î–æ–±–∞–≤—å—Ç–µ swap –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ 2GB swap —Ñ–∞–π–ª–∞
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo swapon --show
```

#### 3. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Docker:

```bash
# –°–±–æ—Ä–∫–∞ —Å –æ–¥–Ω–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
docker build --memory="1g" --cpus="1" -f Dockerfile .
```

#### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pre-compiled –∫–æ–¥:

–°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –∫–æ–¥ –Ω–∞ –º–∞—à–∏–Ω–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ `dist/` –ø–∞–ø–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **`tsconfig.json`** - –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **`tsconfig.prod.json`** - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è production
- **`Dockerfile`** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π production build
- **`Dockerfile.lowmem`** - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏
- **`Dockerfile.dev`** - –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å hot reload

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏:

```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
watch -n 1 'free -m'

# –õ–æ–≥–∏ Docker
docker stats

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–±–æ—Ä–∫–µ
docker build --progress=plain --no-cache -f Dockerfile .
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:

- **"JavaScript heap out of memory"** - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
  - –†–µ—à–µ–Ω–∏–µ: –£–≤–µ–ª–∏—á–∏—Ç—å `--max-old-space-size` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Dockerfile.lowmem`
- **"Killed"** - –ø—Ä–æ—Ü–µ—Å—Å —É–±–∏—Ç OOM killer
  - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å swap –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å RAM

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ deployment

1. **–î–ª—è –ª—é–±—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Dockerfile.swc` - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ!
2. **–î–ª—è VPS —Å 1GB RAM**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Dockerfile` (TypeScript –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä)
3. **–î–ª—è VPS —Å 512MB RAM**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Dockerfile.swc` (SWC –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä)
4. **–î–ª—è shared hosting**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `npm run build:swc` –ª–æ–∫–∞–ª—å–Ω–æ, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–æ–ª—å–∫–æ `dist/`
5. **–î–ª—è –æ–±–ª–∞—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤**: `Dockerfile.swc` - –±—ã—Å—Ç—Ä–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- TypeScript Compiler Options: https://www.typescriptlang.org/tsconfig
- Node.js Memory Management: https://nodejs.org/en/docs/guides/simple-profiling/
- Docker Build Optimization: https://docs.docker.com/build/building/best-practices/
