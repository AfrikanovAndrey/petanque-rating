-- ========================================
-- Скрипт полной очистки данных БД
-- ========================================
-- 
-- ВНИМАНИЕ: Этот скрипт удалит ВСЕ данные из таблиц!
-- Используйте только для тестирования или полной переустановки.
-- 
-- Применение:
-- docker exec -i petanque-mysql mysql -u root -p petanque_rating < backups/clear-database.sql
-- 
-- Или из папки backups:
-- docker exec -i petanque-mysql mysql -u root -p petanque_rating < clear-database.sql
-- 
-- ========================================

USE petanque_rating;

-- Отключаем проверку внешних ключей
SET FOREIGN_KEY_CHECKS = 0;

-- ========================================
-- Очищаем таблицы с данными
-- ========================================

-- Таблицы результатов и очков (зависят от других таблиц)
TRUNCATE TABLE tournament_results;
TRUNCATE TABLE player_tournament_points;

-- Таблицы команд (зависит от players)
TRUNCATE TABLE team_players;
TRUNCATE TABLE teams;

-- Таблица лицензированных игроков (зависит от players)
TRUNCATE TABLE licensed_players;

-- Базовые таблицы
TRUNCATE TABLE players;
TRUNCATE TABLE tournaments;

-- ========================================
-- Административные таблицы (закомментированы для сохранения)
-- ========================================
-- ВНИМАНИЕ: Раскомментируйте следующие строки, если хотите
-- удалить настройки и пользователей

-- Настройки рейтинга
-- TRUNCATE TABLE rating_settings;

-- Пользователи (новая таблица после миграции 001)
-- TRUNCATE TABLE users;

-- Администраторы (старая таблица, может быть удалена после миграции)
-- TRUNCATE TABLE admins;

-- Включаем обратно проверку внешних ключей
SET FOREIGN_KEY_CHECKS = 1;

-- ========================================
-- Восстановление базовых настроек
-- ========================================

-- Восстанавливаем базовые настройки (если были удалены)
INSERT IGNORE INTO rating_settings (setting_name, setting_value, description) VALUES 
  ('best_results_count', '8', 'Количество лучших результатов для подсчета рейтинга'),
  ('current_season', '2025', 'Текущий сезон');

-- ========================================
-- Вывод статуса
-- ========================================

SELECT 'База данных очищена!' as Status;
SELECT 'Настройки и пользователи сохранены.' as Note;
SELECT 'Если нужно очистить настройки/пользователей - раскомментируйте соответствующие строки выше.' as Info;

